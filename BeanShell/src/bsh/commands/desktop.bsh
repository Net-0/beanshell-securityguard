import javax.swing.*;
import bsh.util.JConsole;
import bsh.Interpreter;

desktop() {
	if ( bsh.desktop != void ) {
		print("There is	already	a desktop running...");
		return;
	} else
		bsh.desktop = this;   // race condition (hah!)

	// Ignore unhandled method invocations from listeners.
	invoke( method, args ) { }

	makeFontMenu( Component	component ) {
		menu = new JMenu("Font");
		mi = new JMenuItem("Normal");
		mi.addActionListener(this);
		menu.add(mi);
		mi = new JMenuItem("Big");
		mi.addActionListener(this);
		menu.add(mi);
		mi = new JMenuItem("Bigger");
		mi.addActionListener(this);
		menu.add(mi);

		actionPerformed(e) {
			com = e.getActionCommand();
			if ( com.equals("Normal") )
				setFont( component, 12 );
			else if	( com.equals("Big") )
				setFont( component, 16 );
			else if	( com.equals("Bigger") )
				setFont( component, 20 );
		}

		return menu;
	}

	makeInternalFrame( String name ) {
		// Not closable (if we want this we need to add a listener in
		// workspace to relingquish sys io
		frame = new JInternalFrame(	name, true, false, true, true);
		frame.setDefaultCloseOperation( frame.DO_NOTHING_ON_CLOSE );

		internalFrameClosing( e ) {
			frame.dispose();
			// Return stdin/stdout if we have it
			// ...
		}

		frame.addInternalFrameListener(this);
		frame.setVisible( true );
		return frame;
	}

	addInternalFrame( frame ) {
		bsh.desktop.pane.add( frame	);
		/*
		frame.pack();
		frame.show();
		frame.toFront();
		*/
	}

	windowCount=0;

	mousePressed( e	) {
		popup.show( pane, e.getX(), e.getY() );
	}

	shutdown() {
		/*
		ret = JOptionPane.showInternalConfirmDialog( pane,
			"This workspace	has not	been saved. Do you really want to exit?" );
		if ( ret == JOptionPane.YES_OPTION )
				exit();
		*/
		exit();
	}

	actionPerformed( e ) {
		com = e.getActionCommand();
		if ( com.equals("New Bsh Workspace") )
			makeWorkspace( ""+ super.windowCount++);
		if ( com.equals("New Class Browser") )
			classBrowser();
		else if	( com.equals("Save Workspace") )
			JOptionPane.showInternalMessageDialog( pane, "Unimplemented" );
		else if	( com.equals("Exit") )
			shutdown();
	}

	pane=new JDesktopPane();

	popup=new JPopupMenu("Root Menu");
	mi=new JMenuItem("New Bsh Workspace");
	mi.addActionListener(this);
	popup.add( mi );
	mi=new JMenuItem("New Class Browser");
	mi.addActionListener(this);
	popup.add( mi );
	mi=new JMenuItem("Save Workspace");
	mi.addActionListener(this);
	popup.add( mi );
	mi=new JMenuItem("Exit");
	mi.addActionListener(this);
	popup.add( mi );

	pane.addMouseListener( this );

	frame=new JFrame("BeanShell Desktop 1.0");
	frame.getContentPane().add("Center", pane);
	frame.addWindowListener( this );

	// start one terminal
	makeWorkspace( ""+windowCount++	);

	frame.setSize(800,600);
	frame.show();
	frame.toFront();
	bsh.util.Util.endSplashScreen();
}
